<h2>动画(ms-effect)</h2>
<p>avalon在<strong>1.5</strong>中添加的新指令,是对现有JS动画库或CSS3动画的高级封装。
    avalon核心库本身不是提供任何动画功能。但凭借巧妙的设计，它能很好实现我们要的一切效果，
    甚至比jQuery实现的更简单更炫目！</p>
<p ms-skip=''>avalon 的动画指令 ms-effect="effectName"，当effectName里面不包含{{}}时，属性值 就是我们要的特效名;
    否则，就会跑进内部的解析器，将{{}}里面的变量分析出来，与其他部分结合成我们要的特效名。</p>

<p>ms-effect其实是包括两种动画操作,即进入这页面时的动画(entter),及离开这页面时的动画(leave).</p>

<p>在avalon中,我们可以轻松使用ms-if, ms-visble, ms-include, ms-repeat, ms-each, ms-with触发动画.具体来说,
    ms-if在元素插入DOM树时调用enter动画,移出DOM树时调用leave动画;ms-visible在其真值时调用enter动画,其假值时调用leave动画;
    ms-include有点特别,enter动画与leave动画同时进行,被移出的视图执行leave动画,正在插入的视图执行enter动画;
    ms-repeat, ms-with, ms-each是对一组元素进行添加删除移动,其中添加与移动操作是执行enter动画,删除是执行leave动画,
    因此是一组动画同时,会有点乱,于是提供了data-effect-stagger辅助指令错开每个动画,让整体看起来更加賞心悦目!
</p>

<p>视实现不同,一共分为三种:CSS3 transition动画, CSS3 animation动画, JS动画.</p>


<h3>CSS3 transition动画</h3>

<p>首先元素必须添加一个带transition-duration的类名,或者在内联style指定transition-duration
    (这个可能有厂商前缀,如-webkit,-o-)</p>
然后定义一组类名, 比如.ani, ani.ani-enter, ani.ani-leave(默认是在动画名后加上"-enter","-leave",
换言之,你不使用回调什么的,也不用写avalon.effect了); 
如果你是angular过来的,想重用之前的CSS3,如, xxx, xxx.ng-enter, xxx.ng-leave,再要使用 avalon.effect方法注册一下;

<pre class="brush:javascript;gutter:false;toolbar:false">
avalon.effect("xxx", {
    enterClass: "ng-enter",
    leaveClass: "ng-leave"
})

avalon.effect("flip", {
    enterClass: "flip-en xxx",//可以使用多个类名
    leaveClass: "flip-le yyy"
})


avalon.effect("bounce", {
    enterClass: "bounce-in",
    leaveClass: "bounce-out"
})  
</pre>

<p>如果你想随机执行各种动画效果, 这两个配置项可以改成函数</p>
<pre class="brush:javascript;gutter:false;toolbar:false">
var ani = ["rotate-in", "flip", "zoom-in", "roll", "speed", "elastic"]
var lastIndex = NaN
function getRandomAni() {
    while (true) {
        var index = ~~Math.random() * 6
        if (index != lastIndex) {
            lastIndex = index
            return ani[index]
        }
    }
}
avalon.effect("animate", {
    enterClass: getRandomAni,
    leaveClass: getRandomAni
})
</pre>
<h3>CSS3 animation动画</h3>

<p>首先元素必须添加一个带animation-duration的类名,或者在内联style指定animation-duration, 
    其他流程一样</p>

<h3>JS 动画</h3>
<p>这只是留给IE6-8使用的, avalon.effect中需要你在enter, leave方法
    中实现动画.框架会给这两个方法传入两个参数(el:进行动画的元素,done:动画完成的回调),
    你务必都用上它们.</p>
<pre class="brush:html;gutter:false;toolbar:false">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
        &lt;script src="avalon.js"&gt;&lt;/script&gt;
        &lt;script src="jquery.js"&gt;&lt;/script&gt;
        &lt;style&gt;
            .box{
                width:200px;
                height:200px;
                background: red;
            }
        &lt;/style&gt;
        &lt;script&gt;
            avalon.effect("toggle", {
                enter: function (elem, done) {
                    $(elem).show(500, done)
                },
                leave: function (elem, done) {
                    $(elem).hide(500, done)
                }

            })
            var vm = avalon.define({
                $id: "test",
                bool: true,
                click: function () {
                    vm.bool = !vm.bool
                }
            })

        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body ms-controller="test"&gt;
        &lt;div ms-effect="toggle" ms-visible="bool" class="box"&gt;&lt;/div&gt;
        &lt;p&gt;&lt;button ms-click="click" type="button"&gt;button&lt;/button&gt;&lt;/p&gt;

    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p><img src="zh/bindings/effect/effect01.gif" /></p>
<p>如果上面使用CSS3则是这样实现:</p>
<pre class="brush:html;gutter:false;toolbar:false;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
        &lt;script src="avalon.js"&gt;&lt;/script&gt;
        &lt;style&gt;
            .box{
                width:200px;
                height:200px;
                background: red;
            }
            .toggle{
                transition: all 0.5s ease;
            }
            .toggle-enter{
                width:0px;
                height:0px;
            }
            .toggle-leave{
                width:0px;
                height:0px;
            }
        &lt;/style&gt;
        &lt;script&gt;

            var vm = avalon.define({
                $id: "test",
                bool: true,
                click: function () {
                    vm.bool = !vm.bool
                }
            })

        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body ms-controller="test"&gt;
        &lt;div ms-effect="toggle" ms-visible="bool" class="box toggle"&gt;&lt;/div&gt;
        &lt;p&gt;&lt;button ms-click="click" type="button"&gt;button&lt;/button&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>如果你要使用回调,那就必须在avalon.effect方法的第二个参数对象上添加, 一共有如下回调:</p>
<ul>
    <li>beforeEnter: 在动画开始前执行</li>
    <li>afterEnter: 在动画结束后执行</li>
    <li>abortEnter: 在动画还没有结束前执行,会立即回到原始状态</li>
    <li>beforeLeave: 在动画开始前执行</li>
    <li>afterLeave: 在动画结束后执行</li>
    <li>abortLeave: 在动画还没有结束前执行,会立即回到原始状态</li>
</ul>
<p>我们结合ms-if演示一下效果:</p>
<pre class="brush:html;gutter:false;toolbar:false;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
        &lt;script src="avalon.js"&gt;&lt;/script&gt;
        &lt;style&gt;
            .box{
                width:200px;
                height:200px;
                background: red;
            }
            .toggle{
                transition: all 0.5s ease;
            }
            .toggle-enter{
                width:0px;
                height:0px;
            }
            .toggle-leave{
                width:0px;
                height:0px;
            }
        &lt;/style&gt;
        &lt;script&gt;
            avalon.effect("toggle", {
                afterEnter: function (el) {
                    console.log("enter")
                },
                afterLeave: function (el) {
                    console.log("leave")
                }
            })
            var vm = avalon.define({
                $id: "test",
                bool: true,
                click: function () {
                    vm.bool = !vm.bool
                }
            })

        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body ms-controller="test"&gt;
        &lt;div ms-effect="toggle" ms-if="bool" class="box toggle"&gt;&lt;/div&gt;
        &lt;p&gt;&lt;button ms-click="click" type="button"&gt;button&lt;/button&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p><img src="zh/bindings/effect/effect02.gif" /></p>
<h3>ms-include动画效果</h3>
<p>ms-include的动画效果非常复杂,它的enter动画与leave动画是同时进行.</p>

<p>下例,我们还使用了著名的CSS3动画库<a href="https://daneden.github.io/animate.css/">animate.css</a></p>

<pre class="brush:html;gutter:false;toolbar:false;">
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;meta http-equiv="X-UA-Compatible" content="IE=8" /&gt;
        &lt;script src="avalon.js"&gt;&lt;/script&gt;
        &lt;link rel="stylesheet" href="animate.css" type="text/css"&gt;
        &lt;style&gt;

            .contain{
                border: 1px solid red;
                position:relative;
                width: 200px;
                top:0px;
                height:220px;
            }
            .aaa {
                background: #a9ea00;
                height:200px;
            }
            .bbb {
                background: #e0f2be;
                height:200px;
            }
            .fadeInLeft{
                position: absolute;
                width:100%;
            }
            .fadeOutRight{
                position: absolute;
                width:100%;
            }
            .zoomEffect {
                position: relative;
            }
            .zoomInDown, .zoomOutUp {
                width: 100%;
                height: 100%;
                top: 50%;
                margin-left: -150px;
                margin-top: -170px;
                left: 50%;
                position: absolute;
            }
        &lt;/style&gt;
        &lt;script&gt;
            avalon.effect("xxx", {
                leaveClass: "fadeOutRight",
                enterClass: "fadeInLeft"

            })
            avalon.effect("yyy", {
                enterClass: "zoomInDown",
                leaveClass: "zoomOutUp"
            })
            var a = avalon.define({
                $id: "test",
                aaa: "aaa.html",
                change: function () {
                    a.aaa = a.aaa === "aaa.html" ? "bbb.html" : "aaa.html"
                }
            })

        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body ms-controller="test" style="padding-bottom: 1000px;"&gt;
        &lt;div ms-include-src="'include2'+aaa"  data-include-cache="true"&gt;&lt;/div&gt;
        &lt;h5&gt;data-include-repalce="false"&lt;/h5&gt;
        &lt;div class='contain' style='overflow: hidden'&gt;
            &lt;div ms-include-src="'include2'+aaa"  class="animated" ms-effect="xxx" data-include-cache="true"&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;button type="button" ms-click="change"&gt;change&lt;/button&gt;
        &lt;h5&gt;data-include-replace="true"&lt;/h5&gt;
        &lt;div class='contain zoomEffect' style='overflow: hidden'&gt;
            &lt;div ms-include-src="'include2'+aaa" class="contain animated" ms-effect="yyy" data-include-replace="true" data-include-cache="true"&gt;哈哈哈&lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre>
<p>include2aaa.html</p>
<pre class="brush:html;gutter:false;toolbar:false;">
&lt;div class="aaa"&gt;
    第一个面板
&lt;/div&gt;
</pre>
<p>include2bbb.html</p>
<pre class="brush:html;gutter:false;toolbar:false;">
&lt;div class="aaa"&gt;
    第二个面板
&lt;/div&gt;
</pre>

<p><img src="zh/bindings/effect/effect03.gif" /></p>
